# ASV_Deepfake_with_bilevel
The **Version 2** prototype of End-to-End model with bi-level optimization

## Experiments
### Dataset
The model is trained on the ASVSpoof2019 Dataset with the logical access (LA) Track. We used development set as the validation set and the evaluation set for testing purpose. The dataset is available [here](https://datashare.ed.ac.uk/handle/10283/3336).

|        | # of bonafide audio      |    # of spoof audio   |              |
| --------------------------- |:-------------:| :-------------------------:|---- |
| Training set   |      2580      |           22800         | Spoof audio are generated by 6 known audio synthesis algorithms
| Development set  |     2548   |          22296         |Spoof audio are generated by 6 known algorithms same as Training set
| Evaluation set  |     7355   |          63882        |Spoof audio are generated by 2 known and 11 unknown algorithms


### Training
The followng command runs the training and validation experiment.
```
python training.py --database_path="path/to/the/directory/of/ASVSPOOF2019/LA/database" --protocols_path="path/to/the/directory/of/ASVSPOOF2019/LA/protocols"
```

The default configurations are saved at `model_config.yaml`. If you would like change the configurations of the model, simply change the values in this file directly.

### Testing on ASVSPOOF Dataset
The followng command is for testing the performance of trained-model on the evaluation set.
```
python testing_ASV.py --pre_trained_model_path="E2E-pre_trained.pth" --database_path="path/to/the/directory/of/ASVSPOOF2019/LA/database" --protocols_path="path/to/the/directory/of/ASVSPOOF2019/LA/protocols"
```

After running the previous testing command, an evaluation output file will be created and saved in the current directory, which is named as `eval_scores.txt`. 

To compute the min t-DCF and EER(%):
```
python tDCF_python/evaluate_tDCF_asvspoof19_eval_LA.py 'eval_scores.txt'
```
The code under the folder `tDCF_python` are provided by the ASVSPOOF2019 CHALLENGE for the evaluation purpose.

### Testing on single audio file
`testing_single_file.py` is using the pre-trained model to determine whether one single audio input is bonafide or spoof. Run the following command will output the classification result of the input audio by printing either "bonafide" or "spoof" on the terminal.
```
python3 testing_single_file.py --pre_trained_model_path='/path/to/the/saved/model.pth' --AUDIO_path='ADD_A_00000000.wav'
```
`ADD_A_00000000.wav` is a sample audio file, which is from the evaluation set of ADD2022 Challenge Dataset (Track2)

## Results
The results of our model are obtained by training the single system without the ensemble or data augmentation. The result of top-5 **single systems** in ASVSpoof2019 Challenge and the two baselines are also included in the table for comparison, which are provided by the [overview paper of ASVSpoof2019 challenge](https://arxiv.org/pdf/2102.05889.pdf).
|                   |    min-tDCF      |          EER[%]        |
| -----------------|-------------:| -------------------------:|
| **V2-model with bi-level optimization training (Our model)**  |   **0.1555**   |   **5.65**       |
| Top-model01  |      0.1562       |           5.06          |
| Top-model02  |      0.1655       |           4.04          |
| Top-model03  |      0.1894       |           7.01          |
| Top-model04  |      0.1937       |           5.97          |
| Top-model05  |      0.1939       |           5.74          |
| Baseline02  |      0.2605       |           8.09          |
| Baseline01  |      0.2839       |           9.57          |
| V2-model (Our model)  |      0.2931       |           15.38          |

